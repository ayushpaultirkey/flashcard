window.$fx={};class Component{constructor(){this.id=crypto.randomUUID(),this.binding={},this.root=null,this.parent=null,this.child={},this.element={},this.args={}}async render(){return this.node("div")}async pre(e=null,t={}){if(this.root=await this.render(),await this.init(t),null==e)return this.root;document.querySelector(e).append(this.root)}async init(e={}){}bind(e=null){let t=crypto.randomUUID();return $fx[t]=e.bind(this),`$fx['${t}']();`}async component(e=null,t={}){if(e instanceof Object){let s=new e;return s.parent=this,s.args=t,this.child[s.id]=s,await s.pre(null,t)}}node(e="",t=[],s={}){let i="x"+Math.random().toString(36).slice(6),o=document.createElement(e),n=[],a=!1;for(var l=0,r=t.length;l<r;l++){if("string"==typeof t[l]){let d=t[l].match(/{.*?}/g);null!==d&&(void 0===this.binding[d[0]]&&(this.binding[d[0]]={element:[],data:d[0]}),this.binding[d[0]].element.push({id:i,type:0,map:t[l]}),a=!0)}o.append(t[l])}for(let h in s){let c=s[h];if("function"==typeof c)c=this.bind(c);else if("object"==typeof c){for(let u in c){let p=(o.hasAttribute(u)?o.getAttribute(u):"")+c[u].toString();-1!==p.indexOf("{")&&(n.push(u),a=!0),o.setAttribute(u,p)}continue}else"string"==typeof c&&-1!==c.indexOf("{")&&(n.push(h),a=!0);o.setAttribute(h,c)}let g=[...new Set(n)];for(var l=0,r=g.length;l<r;l++){let w=o.getAttribute(g[l]),f=w.match(/{.*?}/g);if(null!==f)for(var b=0,m=f.length;b<m;b++)void 0===this.binding[f[b]]&&(this.binding[f[b]]={element:[],data:f[l]}),this.binding[f[b]].element.push({id:i,type:g[l],map:w+("class"===g[l]?` ${i}`:"")})}return a&&o.classList.add(i),o}Set(e="",t=""){let s=e.indexOf("++");e=e.replace("++","");let i=this.binding[e];if(void 0===i)return null;"function"==typeof t&&(t=this.bind(t));let o=i.element;for(var n=0,a=o.length;n<a;n++){let l=o[n].map,r=this.root.classList.contains(o[n].id)?this.root:this.root.querySelector(`.${o[n].id}`);if(0==o[n].type){let d=0==s?"afterbegin":"beforeend";t instanceof Element?(-1!==s?r.insertAdjacentElement(d,t):(r.childNodes.forEach(e=>e.remove()),r.appendChild(t)),t=t.outerHTML):-1!==s?r.insertAdjacentHTML(d,t):r.innerHTML=t}else{let h=l.match(/{.*?}/g);if(null!==h)for(var c=0,u=h.length;c<u;c++){if(h[c]===e){l=l.replace(h[c],t);continue}let p=this.binding[h[c]];void 0!==p&&(l=l.replace(h[c],p.data))}r.setAttribute(o[n].type,l)}}i.data=t}Get(e=""){return void 0===this.binding[e]?null:this.binding[e].data}Unique(e="id",t=this.element){this.root.querySelectorAll(`[${e}]`).forEach(s=>{let i="x"+Math.random().toString(36).slice(6);t[s.getAttribute(e)]=s,s.setAttribute(e,i)})}}Component.Render=async function(e=null,t=null,s={}){let i=new e;await i.pre(s,t)};const Dispatcher={};Dispatcher.Target=new EventTarget,Dispatcher.On=function(e="",t=null){e.length>0&&null!==t&&Dispatcher.Target.addEventListener(e,e=>{t(e,e.detail)},!0)},Dispatcher.Call=function(e="",t=null){e.length>0&&Dispatcher.Target.dispatchEvent(new CustomEvent(e,{detail:t}))};class E404 extends Component{constructor(){super()}async init(){}async render(){return this.node("div",[this.node("label",["404"],{class:"text-4xl"}),this.node("label",[this.node("span",["Page not found"])])],{class:"flex flex-col"})}}class Login extends Component{constructor(){super()}async init(){let e=await fetch("/api/user/get"),t=await e.json();t.success&&(window.location.hash="#home"),this.Unique(),this.Set("{e.login}",this.Login),this.Set("{error.visible}","hidden"),this.Set("{error.message}","")}render(){return this.node("div",[this.node("div",[this.node("label",[this.node("span",["flashcard."]),this.node("label",[this.node("span",["v0.1"])],{class:"text-xs"})],{class:"text-lg font-bold text-gray-700"}),this.node("label",["Login"],{class:"text-sm font-bold text-gray-700"}),this.node("label",[this.node("span",["{error.message}"])],{class:"text-xs font-bold text-red-500 {error.visible}"}),this.node("input",[],{id:"username",class:"bg-gray-200 px-3 py-2 text-xs rounded-lg outline-0 transition-shadow hover:shadow-md",type:"text",placeholder:"Username"}),this.node("input",[],{id:"password",class:"bg-gray-200 px-3 py-2 text-xs rounded-lg outline-0 transition-shadow hover:shadow-md",type:"password",placeholder:"Password"}),this.node("div",[this.node("button",["Login"],{onclick:"{e.login}",class:"bg-blue-400 text-xs px-6 py-2 w-24 rounded-lg transition-shadow hover:shadow-md hover:shadow-blue-200"})]),this.node("label",[this.node("span",["Don't have an account"]),this.node("br",[]),this.node("span",["Signup"])],{class:"text-sm"}),this.node("div",[this.node("button",["Signup"],{onclick:"window.location.hash = '#signup';",class:"bg-gray-200 text-xs px-6 py-2 w-24 rounded-lg transition-shadow hover:shadow-md"})])],{class:"w-full flex flex-col space-y-3"})],{class:"h-full flex items-center"})}async Login(){this.Set("{error.visible}","hidden"),this.Set("{error.message}","");let e=this.element.username,t=this.element.password;try{if(e.value.length<2||t.value.length<2)throw"Enter username and password";let s=await fetch(`/api/login?username=${e.value}&password=${t.value}`),i=await s.json();if(!i.success)throw i.message;window.location.hash="#home"}catch(o){this.Set("{error.visible}","visible"),this.Set("{error.message}",o)}}}class Signup extends Component{constructor(){super()}async init(){this.Unique(),this.Set("{button.signup}",this.Signup),this.Set("{error.visible}","hidden"),this.Set("{error.message}","")}render(){return this.node("div",[this.node("div",[this.node("label",[this.node("span",["flashcard."]),this.node("label",[this.node("span",["v0.1"])],{class:"text-xs"})],{class:"text-lg font-bold text-gray-700"}),this.node("label",["Signup"],{class:"text-sm font-bold text-gray-700"}),this.node("label",[this.node("span",["{error.message}"])],{class:"text-xs font-bold text-red-500 {error.visible}"}),this.node("input",[],{id:"name",class:"bg-gray-200 px-3 py-2 text-xs rounded-lg outline-0 transition-shadow hover:shadow-md",type:"text",placeholder:"Name"}),this.node("input",[],{id:"username",class:"bg-gray-200 px-3 py-2 text-xs rounded-lg outline-0 transition-shadow hover:shadow-md",type:"text",placeholder:"Username"}),this.node("input",[],{id:"password",class:"bg-gray-200 px-3 py-2 text-xs rounded-lg outline-0 transition-shadow hover:shadow-md",type:"password",placeholder:"Password"}),this.node("div",[this.node("button",["Signup"],{onclick:"{button.signup}",class:"bg-blue-400 text-xs px-6 py-2 w-24 rounded-lg transition-shadow hover:shadow-md hover:shadow-blue-200"})]),this.node("label",[this.node("span",["Already have an account"]),this.node("br",[]),this.node("span",["Login"])],{class:"text-sm"}),this.node("div",[this.node("button",["Login"],{onclick:"window.location.hash = '#login';",class:"bg-gray-200 text-xs px-6 py-2 w-24 rounded-lg transition-shadow hover:shadow-md"})])],{class:"w-full flex flex-col space-y-3"})],{class:"h-full flex items-center"})}async Signup(){this.Set("{error.visible}","hidden"),this.Set("{error.message}","");let e=this.element.name,t=this.element.username,s=this.element.password;try{if(e.value.length<2||t.value.length<2||s.value.length<2)throw"Enter name, username and password";let i=await fetch(`/api/signup?name=${e.value}&username=${t.value}&password=${s.value}`),o=await i.json();if(!o.success)throw o.message;window.location.hash="#home"}catch(n){this.Set("{error.visible}","visible"),this.Set("{error.message}",n)}}}class Header extends Component{constructor(){super()}async init(e={}){this.Set("{c-hidden}","hidden"),this.Set("{e-hidden}",this.Menu),this.Set("{user.logout}",this.Logout)}render(){return this.node("div",[this.node("div",[this.node("a",["flashcard"],{class:"sm:text-xl",href:"#home"}),this.node("span",[],{class:"w-full"}),this.node("button",[],{onclick:"{e-hidden}",class:"fa fa-bars text-xl transition-colors hover:text-blue-500"})],{class:"flex items-center"}),this.node("div",[this.node("a",["Home"],{href:"#home"}),this.node("a",["Search"],{href:"#search"}),this.node("a",["Profile"],{href:"#user"}),this.node("label",["Logout"],{onclick:"{user.logout}"})],{class:"flex flex-col text-sm space-y-2 my-3 font-semibold underline {c-hidden}"})])}Menu(){this.Set("{c-hidden}","hidden"==this.Get("{c-hidden}")?"visible":"hidden")}async Logout(){let e=await fetch("/api/logout"),t=await e.json();t.redirect.length>0&&(window.location.hash=t.redirect)}}class Create extends Component{constructor(){super()}init(){this.Unique(),this.Set("{post.create}",this.Create)}render(){return this.node("div",[this.node("textarea",[],{id:"postbox",class:"bg-transparent w-full h-20 resize-none text-sm outline-none",placeholder:"Write Something"}),this.node("button",["Create"],{onclick:"{post.create}",class:"bg-blue-400 text-xs px-6 py-2 rounded-lg transition-shadow hover:shadow-md hover:shadow-blue-200"})],{class:"bg-gray-100 p-3 rounded-lg shadow-md border-2 border-gray-200 border-opacity-50"})}async Create(){let e=this.element.postbox;if(null!==e||e.value.length>0){let t=await fetch(`/api/post/create?content=${e.value}`),s=await t.json();s.success?this.parent.PostLoad():alert("Unable to post")}}}class Card extends Component{constructor(){super(),this.Liked=!1}async init(e={}){this.Liked=e.liked,this.Set("{t-content}",e.content),this.Set("{t-author}",e.name),this.Set("{t-time}",e.time),this.Set("{t-like}",e.like),this.Set("{e-like}",this.Like),this.Set("{e-delete}",this.Delete),this.Set("{user.redirect}",this.Redirect),this.Set("{c-like}",this.Liked?"text-blue-400":"text-black"),this.Set("{c-border-color}",this.Liked?"border-blue-400":"border-gray-200"),this.Set("{c-delete}",e.delete?"visible":"invisible")}render(){return this.node("div",[this.node("div",[this.node("label",[this.node("span",["@"]),this.node("span",["{t-author}"])],{class:"font-semibold",onclick:"{user.redirect}"}),this.node("label",[this.node("span",["at "]),this.node("span",["{t-time}"])],{class:"text-xs font-semibold"})],{class:"text-sm flex flex-col"}),this.node("div",[this.node("label",[this.node("span",["{t-content}"])],{class:"text-sm"})]),this.node("div",[this.node("button",[],{onclick:"{e-like}",class:"fa fa-heart {c-like}"}),this.node("label",[this.node("span",["{t-like}"])],{class:"text-sm"}),this.node("button",[],{class:"{c-delete} fa fa-trash absolute right-0 text-sm",onclick:"{e-delete}"})],{class:"space-x-2 flex items-center relative"})],{class:"bg-gray-100 p-3 mt-3 sm:space-y-4 space-y-2 rounded-lg shadow-md border-2 {c-border-color} border-opacity-50 transition-colors"})}Redirect(){window.location.hash=`#user?id=${this.args.userid}`}async Like(){let e=await fetch(`/api/post/like?postid=${this.args.id}`),t=await e.json(),s=parseInt(this.Get("{t-like}"));t.data.liked?this.Set("{t-like}",s+1):this.Set("{t-like}",s-1<0?0:s-1),this.Set("{c-like}",t.data.liked?"text-blue-400":"text-black"),this.Set("{c-border-color}",t.data.liked?"border-blue-400":"border-gray-200")}async Delete(){let e=await fetch(`/api/post/delete?postid=${this.args.id}`),t=await e.json();t.success?this.parent.PostLoad():alert(t.message),Dispatcher.Call("OnPostChange")}}class PCard extends Component{constructor(){super()}async init(e={}){this.Set("{user.name}",e.name),this.Set("{user.following}",e.following?"Following":"Follow"),this.Set("{follow.visible}",e.follow?"visible":"invisible"),this.Set("{user.follow}",this.Follow),this.Set("{user.redirect}",this.Redirect)}async render(){return this.node("div",[this.node("div",[this.node("label",[this.node("span",["@"]),this.node("span",["{user.name}"])],{class:"w-full font-semibold",onclick:"{user.redirect}"}),this.node("button",[this.node("span",["{user.following}"])],{onclick:"{user.follow}",class:"bg-blue-400 text-xs px-6 py-2 rounded-lg transition-shadow hover:shadow-md hover:shadow-blue-400 {follow.visible}"})],{class:"flex items-center"})],{class:"space-y-3 p-3 mt-3 bg-gray-100 shadow-md rounded-lg border-2 border-gray-200 border-opacity-50"})}async Follow(){let e=await fetch(`/api/user/follow?userid=${this.args.id}`),t=await e.json();this.Set("{user.following}",t.data.following?"Following":"Follow"),Dispatcher.Call("OnFollowChange")}Redirect(){window.location.hash=`#user?id=${this.args.id}`}}class Profile extends Component{constructor(){super(),this.userid=""}async init(){let e=window.location.hash,t=e.match(/\?id=[0-9]*/g);null!==t&&(this.userid=t[0].split("=")[1]),this.Load(!0),this.Set("{post.active}","font-normal"),this.Set("{follower.active}","font-normal"),this.Set("{following.active}","font-normal"),this.Set("{user.follow}",this.Follow),this.Set("{tab.post}",()=>{this.Tab("post")}),this.Set("{tab.follower}",()=>{this.Tab("follower")}),this.Set("{tab.following}",()=>{this.Tab("following")}),this.Tab("post"),Dispatcher.On("OnFollowChange",this.Load.bind(this)),Dispatcher.On("OnPostChange",this.Load.bind(this))}async render(){return this.node("div",[this.node("div",[this.node("label",[this.node("span",["@"]),this.node("span",["{user.name}"])],{class:"w-full font-semibold"}),this.node("button",[this.node("span",["{user.following}"])],{onclick:"{user.follow}",class:"bg-blue-400 text-xs px-6 py-2 rounded-lg transition-shadow hover:shadow-md hover:shadow-blue-400 {follow.visible}"})],{class:"flex items-center"}),this.node("div",[this.node("button",[this.node("span",["Post"]),this.node("br",[]),this.node("span",["{post.count}"])],{onclick:"{tab.post}",class:"{post.active}"}),this.node("button",[this.node("span",["Follower"]),this.node("br",[]),this.node("span",["{follower.count}"])],{onclick:"{tab.follower}",class:"{follower.active}"}),this.node("button",[this.node("span",["Following"]),this.node("br",[]),this.node("span",["{following.count}"])],{onclick:"{tab.following}",class:"{following.active}"})],{class:"space-x-3 text-sm"})],{class:"space-y-3 p-3 bg-gray-100 shadow-md rounded-lg border-2 border-gray-200 border-opacity-50"})}async Load(e=!1){let t=await fetch(`/api/user/get${0==this.userid.length?"":`?userid=${this.userid}`}`),s=await t.json();s.redirect.length>0&&(window.location.hash=s.redirect),this.Set("{user.name}",s.data.user_name),this.Set("{post.count}",s.data.post_count),this.Set("{follower.count}",s.data.follower_count),this.Set("{following.count}",s.data.following_count),this.Set("{follow.visible}",s.data.can_follow?"visible":"invisible"),this.Set("{user.following}",s.data.user_following?"Following":"Follow")}Tab(e="post"){"post"==e?(this.Set("{post.active}","font-bold"),this.Set("{follower.active}","font-normal"),this.Set("{following.active}","font-normal"),this.parent.PostLoad()):"follower"==e?(this.Set("{post.active}","font-normal"),this.Set("{follower.active}","font-bold"),this.Set("{following.active}","font-normal"),this.parent.FollowLoad("follower")):(this.Set("{post.active}","font-normal"),this.Set("{follower.active}","font-normal"),this.Set("{following.active}","font-bold"),this.parent.FollowLoad("following"))}async Follow(){if(this.userid>0){let e=await fetch(`/api/user/follow?userid=${this.userid}`),t=await e.json();this.Set("{user.following}",t.data.following?"Following":"Follow"),Dispatcher.Call("OnFollowChange")}}}class Home extends Component{constructor(){super()}async init(){this.PostLoad()}async render(){return this.node("div",[await this.component(Header,{}),this.node("div",[await this.component(Create,{}),this.node("span",["{post.list}"])],{class:"space-y-3"})],{class:"space-y-5"})}async PostLoad(){let e=await fetch("/api/post/list"),t=await e.json();t.redirect.length>0&&(window.location.hash=t.redirect),this.Set("{post.list}","");let s=t.data;for(var i=0,o=s.length;i<o;i++){let n=s[i].post_date.split("T");this.Set("{post.list}++",await this.component(Card,{id:s[i].post_id,userid:s[i].user_id,name:s[i].user_name,time:`${n[0]} ${n[1].split(".")[0]}`,like:s[i].post_like,content:s[i].post_content,delete:s[i].post_delete,liked:s[i].post_liked}))}}}class Search extends Component{constructor(){super()}async init(){this.Unique(),this.Load(),this.Set("{user.search}",this.Load)}async render(){return this.node("div",[await this.component(Header,{}),this.node("div",[this.node("input",[],{id:"search",class:"bg-gray-200 px-3 py-2 w-full text-xs rounded-lg rounded-r-none outline-0 transition-shadow hover:shadow-md",type:"text",placeholder:"Search People"}),this.node("button",[this.node("i",[],{class:"fa fa-search"})],{onclick:"{user.search}",class:"bg-blue-400 text-xs px-6 py-2 rounded-lg rounded-l-none transition-shadow hover:shadow-md hover:shadow-blue-200"})],{class:"flex"}),this.node("span",["{search.list}"])],{class:"space-y-5"})}async Load(){let e=await fetch(`/api/user/search?name=${this.element.search.value}`),t=await e.json();t.redirect.length>0&&(window.location.hash=t.redirect),this.Set("{search.list}","");let s=t.data;for(var i=0,o=s.length;i<o;i++)this.Set("{search.list}++",await this.component(PCard,{id:s[i].user_id,name:s[i].user_name,following:s[i].user_following,follow:s[i].user_follow}))}}class User extends Component{constructor(){super(),this.userid=""}async init(){let e=window.location.hash,t=e.match(/\?id=[0-9]*/g);null!==t&&(this.userid=t[0].split("=")[1]),this.PostLoad()}async render(){return this.node("div",[await this.component(Header,{}),await this.component(Profile,{}),this.node("span",["{content.list}"])],{class:"space-y-5"})}async PostLoad(){let e=await fetch(`/api/post/list${0==this.userid.length?"?self":`?userid=${this.userid}`}`),t=await e.json();t.redirect.length>0&&(window.location.hash=t.redirect),this.Set("{content.list}","");let s=t.data;for(var i=0,o=s.length;i<o;i++){let n=s[i].post_date.split("T");this.Set("{content.list}++",await this.component(Card,{id:s[i].post_id,userid:s[i].user_id,name:s[i].user_name,time:`${n[0]} ${n[1].split(".")[0]}`,like:s[i].post_like,content:s[i].post_content,delete:s[i].post_delete,liked:s[i].post_liked}))}}async FollowLoad(e="follower"){let t=await fetch(`/api/user/${e}/list${0==this.userid.length?"":`?userid=${this.userid}`}`),s=await t.json();s.redirect.length>0&&(window.location.hash=s.redirect),this.Set("{content.list}","");let i=s.data;for(var o=0,n=i.length;o<n;o++)this.Set("{content.list}++",await this.component(PCard,{id:i[o].user_id,name:i[o].user_name,following:i[o].user_following,follow:i[o].user_follow}))}}class Router{constructor(e={}){this.route={},this.component=null,this.key="",this.default="",Object.assign(this,e)}Add(e="",t=null){this.list[e]=t}Find(e=""){let t=this.route[e.toLowerCase()];return void 0!==t?t:E404}async Set(){let e=window.location.hash,t=e.match(/\#\w+/g);if(0==e.length&&(window.location.hash=this.default),null!==t){let s=this.Find(t[0]),i=new s;this.component.Set(this.key,await i.pre())}}Observe(){window.onhashchange=()=>{this.Set()}}}Router.Hash=function(e=""){window.location.hash=e};class App extends Component{constructor(){super()}async init(){let e=new Router({component:this,key:"{app}",route:{"#login":Login,"#signup":Signup,"#home":Home,"#user":User,"#search":Search},default:"#login"});e.Set(),e.Observe()}async render(){return this.node("div",["{app}"],{class:"w-full h-full overflow-auto p-6 scroll"})}}Component.Render(App,{},".app");